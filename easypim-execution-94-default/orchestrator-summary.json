{
  "AssignmentsCreated": 0,
  "AssignmentsPlanned": 9,
  "Status": "Success",
  "OrchestoratorOutput": "\n+----------------------------------------------------+\n| Starting EasyPIM Orchestration (Mode: delta)\n+----------------------------------------------------+\n\n✅ [AUTH] Microsoft Graph connection verified (Identity: b7375796-5ca8-447b-9966-3b27be75090e)\n✅ [AUTH] Azure PowerShell connection verified (Account: b7375796-5ca8-447b-9966-3b27be75090e, Subscription: ME-MngEnvMCAP131594-loicmichel-1)\nReading configuration from Key Vault 'kv-easypim-8368', secret 'easypim-config-json'\nLoaded Module 'Az.Accounts'\nLoaded Module 'Az.KeyVault'\n✅ Using Key Vault secret version: 7ed1559b210c41dfa28edaa0a5d30162 (created: 09/06/2025 16:56)\n🔍 Validating configuration...\n🔍 Starting EasyPIM configuration validation...\n📋 Validating PolicyTemplates...\n📋 Validating EntraRoles policies...\n📋 Validating AzureRoles policies...\n✅ Configuration validation completed\n   Issues found: 1\n   Auto-corrections: 1\n⚠️ Configuration validation found issues:\n  ⚠️ Warnings: 1\n  ⚠️ [FieldNameMismatch] PolicyTemplates.HighSecurity.Approvers[0]\n    Field 'description' should be 'Name'\n    💡 Change 'description' to 'Name' in Approvers configuration\n\n✅ Auto-corrections applied:\n  + Auto-corrected Approvers format in PolicyTemplates.HighSecurity\n📝 Using auto-corrected configuration\n🔍 [DEBUG] Attempting to send startup telemetry...\n🔍 [DEBUG] Using KeyVault parameter set for telemetry\n🔍 [TELEMETRY] Checking telemetry configuration from config object...\n🔍 [DEBUG] Send-TelemetryEventFromConfig called for event: orchestrator_startup\n🔍 [DEBUG] Config object received, checking TelemetrySettings...\n🔍 [DEBUG] Config.TelemetrySettings exists: True\n🔍 [DEBUG] Config.TelemetrySettings.ALLOW_TELEMETRY value: True\n✅ [TELEMETRY] Telemetry enabled - preparing event: orchestrator_startup\n✅ [DEBUG] Telemetry enabled - proceeding with event: orchestrator_startup\nGenerated privacy-protected telemetry identifier (SHA256)\n✅ [DEBUG] Telemetry identifier created successfully\nGenerated new telemetry session ID: 31f85ea7-c4e7-4e35-8e27-d96b38e00215\nRequested HTTP/1.1 POST with 635-byte payload\nReceived HTTP/1.1 15-byte response of content type application/json\nContent encoding: utf-8\nPostHog API responded successfully. Status: Ok\n✅ [DEBUG] PostHog API call succeeded\nTelemetry event sent successfully: orchestrator_startup\n✅ [DEBUG] Telemetry event sent successfully: orchestrator_startup\n[Initialize-EasyPIMAssignments] Processing assignment configuration\n[Initialize-EasyPIMAssignments] Processing 2 Entra role assignment groups\n[Initialize-EasyPIMAssignments] Processing 4 Azure role assignment groups\n[Initialize-EasyPIMAssignments] Processed assignments -> Azure(E:2 A:4) Entra(E:2 A:1) Groups(E:1 A:0)\n⚙️ [PROC] Processing policy configurations...\nStarting Initialize-EasyPIMPolicies (Orchestrator)\n🔍 Validating configuration for common issues...\n🔍 Starting EasyPIM configuration validation...\n📋 Validating PolicyTemplates...\n📋 Validating EntraRoles policies...\n📋 Validating AzureRoles policies...\n✅ Configuration validation completed\n   Issues found: 0\n   Auto-corrections: 0\n✅ Configuration validation passed\nFound 2 policy templates\nProcessing EntraRoles.Policies section\nResolving policy configuration for EntraRole\nResolving policy configuration for EntraRole\nResolving policy configuration for EntraRole\n[Auto-Config] User Administrator: AllowPermanentEligibility=false (MaximumEligibilityDuration specified), AllowPermanentActiveAssignment=false (MaximumActiveAssignmentDuration specified)\nResolving policy configuration for EntraRole\nResolving policy configuration for EntraRole\n[Auto-Config] Global Administrator: AllowPermanentEligibility=false (MaximumEligibilityDuration specified), AllowPermanentActiveAssignment=false (MaximumActiveAssignmentDuration specified)\nResolving policy configuration for EntraRole\nProcessed 6 Entra Role policies from EntraRoles.Policies\nProcessing AzureRoles.Policies section\nResolving policy configuration for AzureRole\nResolving policy configuration for AzureRole\nResolving policy configuration for AzureRole\nResolving policy configuration for AzureRole\n[Auto-Config] Contributor: AllowPermanentEligibility=false (MaximumEligibilityDuration specified), AllowPermanentActiveAssignment=false (MaximumActiveAssignmentDuration specified)\nProcessed 4 Azure Role policies from AzureRoles.Policies\nProcessing GroupRoles.Policies section\nResolving policy configuration for Group\n[Auto-Config] Member: AllowPermanentEligibility=false (MaximumEligibilityDuration specified), AllowPermanentActiveAssignment=false (MaximumActiveAssignmentDuration specified)\nResolving policy configuration for Group\n[Auto-Config] Owner: AllowPermanentEligibility=false (MaximumEligibilityDuration specified), AllowPermanentActiveAssignment=false (MaximumActiveAssignmentDuration specified)\nProcessed 2 Group policies from GroupRoles.Policies\nInitialize-EasyPIMPolicies completed successfully\n🔍 [TEST] Validating principal and group IDs...\n[Orchestrator] TenantId in context before validation: 9b08d26c-2c4e-45c8-9313-b700c2ee6e3d\n[Debug] Using Test-PrincipalExists from: EasyPIM.Orchestrator ()\n[Orchestrator] Collected 2 approver references (2 unique) from policyConfig.EntraRolePolicies\n[Debug] Checking principal: f8b74308-47bf-4764-a31e-634e54c36212\nGET https://graph.microsoft.com/v1.0/directoryObjects/f8b74308-47bf-4764-a31e-634e54c36212 with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/f8b74308-47bf-4764-a31e-634e54c36212 with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: 8b0995d0-4c07-4814-98c8-550dc0af62cf\nGET https://graph.microsoft.com/v1.0/directoryObjects/8b0995d0-4c07-4814-98c8-550dc0af62cf with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/8b0995d0-4c07-4814-98c8-550dc0af62cf with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: fea62dfc-656b-47f1-814c-34c1cb3597ec\nGET https://graph.microsoft.com/v1.0/directoryObjects/fea62dfc-656b-47f1-814c-34c1cb3597ec with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/fea62dfc-656b-47f1-814c-34c1cb3597ec with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: a83b74b8-fb37-4ad4-99ec-1132ea8b56d6\nGET https://graph.microsoft.com/v1.0/directoryObjects/a83b74b8-fb37-4ad4-99ec-1132ea8b56d6 with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/a83b74b8-fb37-4ad4-99ec-1132ea8b56d6 with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: d170ce5d-1c4e-40f0-96ab-acab2457e05b\nGET https://graph.microsoft.com/v1.0/directoryObjects/d170ce5d-1c4e-40f0-96ab-acab2457e05b with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/d170ce5d-1c4e-40f0-96ab-acab2457e05b with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: e54e29a4-5c6f-47a6-a5d7-7d555f77fb41\nGET https://graph.microsoft.com/v1.0/directoryObjects/e54e29a4-5c6f-47a6-a5d7-7d555f77fb41 with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/e54e29a4-5c6f-47a6-a5d7-7d555f77fb41 with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: dcd31c16-eba2-4a6e-bf69-3c3d402b242b\nGET https://graph.microsoft.com/v1.0/directoryObjects/dcd31c16-eba2-4a6e-bf69-3c3d402b242b with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/dcd31c16-eba2-4a6e-bf69-3c3d402b242b with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: b08e4e66-2d4c-4804-be04-f37d2b038342\nGET https://graph.microsoft.com/v1.0/directoryObjects/b08e4e66-2d4c-4804-be04-f37d2b038342 with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/b08e4e66-2d4c-4804-be04-f37d2b038342 with 0-byte payload\nreceived -byte response of content type application/json\n[Debug] Checking principal: 2ab3f204-9c6f-409d-a9bd-6e302a0132db\nGET https://graph.microsoft.com/v1.0/directoryObjects/2ab3f204-9c6f-409d-a9bd-6e302a0132db with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/directoryObjects/2ab3f204-9c6f-409d-a9bd-6e302a0132db with 0-byte payload\nreceived -byte response of content type application/json\n✅ [OK] Principal validation passed (9 principals checked, 0 missing)\n[Orchestrator Debug] Assignment counts -> Azure(E:2 A:4) Entra(E:2 A:1) Groups(E:1 A:0)\n[Orchestrator] Delegating to New-EPOEasyPIMPolicies (mode: delta)\nStarting New-EPOEasyPIMPolicies in delta mode\n[WARNING] Skipping Azure Role Policies processing due to WhatIf\n   Would have applied the following policy configurations:\n       * Role: 'Reader' | Scope: '/subscriptions/442734fd-2546-4a3b-b4c7-f351bd5ff93a' | Activation Duration: PT12H | MFA Required: No | Justification Required: No | Approval Required: False | Max Eligibility:  | Permanent Eligibility: Not Allowed\n       * Role: 'Tag Contributor' | Scope: '/subscriptions/442734fd-2546-4a3b-b4c7-f351bd5ff93a' | Activation Duration: PT8H | MFA Required: No | Justification Required: Yes | Approval Required: False | Max Eligibility:  | Permanent Eligibility: Not Allowed\n       * Role: 'Storage Table Data Contributor' | Scope: '/subscriptions/442734fd-2546-4a3b-b4c7-f351bd5ff93a/resourceGroups/cloud-shell-storage-westeurope/providers/Microsoft.Storage/storageAccounts/devjnsppstorlb2a2z' | Activation Duration: PT8H | MFA Required: No | Justification Required: No | Approval Required:  | Max Eligibility:  | Permanent Eligibility: Allowed\n       * Role: 'Contributor' | Scope: '/subscriptions/442734fd-2546-4a3b-b4c7-f351bd5ff93a' | Activation Duration: PT30M | MFA Required: No | Justification Required: Yes | Approval Required: True | Approvers: IAM_approvers (2ab3f204-9c6f-409d-a9bd-6e302a0132db) | Authentication Context: c1:HighRiskOperations | Max Eligibility: P90D | Permanent Eligibility: Not Allowed\nGET https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions?$filter=displayName eq 'Guest Inviter' with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions?$filter=displayName eq 'testrole' with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions?$filter=displayName eq 'User Administrator' with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions?$filter=displayName eq 'Security Administrator' with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions?$filter=displayName eq 'Global Administrator' with 0-byte payload\nreceived -byte response of content type application/json\nGET https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions?$filter=displayName eq 'Exchange Administrator' with 0-byte payload\nreceived -byte response of content type application/json\n[WARNING] Skipping Entra Role Policies processing due to WhatIf\n   Would have applied the following policy configurations:\n       * Role: 'Guest Inviter' | Activation Duration: PT8H | Requirements: MultiFactorAuthentication, Justification | Approval Required: False\n       * Role: 'testrole' | Activation Duration: PT8H | Requirements: MultiFactorAuthentication, Justification | Approval Required: False\n       * Role: 'User Administrator' | Activation Duration: PT2H | Requirements: MultiFactorAuthentication, Justification | Approval Required: True | Approvers: @{Name=IAM_approvers; id=2ab3f204-9c6f-409d-a9bd-6e302a0132db} | Authentication Context: c1:HighRiskOperations | Max Eligibility: P90D | Permanent Eligibility: Not Allowed\n       * Role: 'Security Administrator' [⚠️ PROTECTED - BLOCKED] | Activation Duration: PT8H | Requirements: MultiFactorAuthentication, Justification | Approval Required: False\n       * Role: 'Global Administrator' [⚠️ PROTECTED - BLOCKED] | Activation Duration: PT1H | Requirements: MultiFactorAuthentication, Justification | Approval Required: True | Approvers: @{Name=IAM_approvers; id=2ab3f204-9c6f-409d-a9bd-6e302a0132db} | Authentication Context: c1:HighRiskOperations | Max Eligibility: P60D | Permanent Eligibility: Not Allowed\n       * Role: 'Exchange Administrator' | Activation Duration: PT8H | Requirements: MultiFactorAuthentication, Justification | Approval Required: True | [WARNING: ApprovalRequired is true but no Approvers specified!]\n[WARNING] Skipping Group Policies processing due to WhatIf\n   Would have applied the following policy configurations:\n       * Group ID: 'b08e4e66-2d4c-4804-be04-f37d2b038342' | Role: 'Member' | Activation Duration: PT2H | MFA Required: No | Justification Required: Yes | Approval Required: True | Approvers: IAM_approvers (2ab3f204-9c6f-409d-a9bd-6e302a0132db) | Authentication Context: c1:HighRiskOperations | Max Eligibility: P90D | Permanent Eligibility: Not Allowed\n       * Group ID: 'b08e4e66-2d4c-4804-be04-f37d2b038342' | Role: 'Owner' | Activation Duration: PT1H | MFA Required: No | Justification Required: Yes | Approval Required: True | Approvers: IAM_approvers (2ab3f204-9c6f-409d-a9bd-6e302a0132db) | Authentication Context: c1:HighRiskOperations | Max Eligibility: P30D | Permanent Eligibility: Not Allowed\nNew-EPOEasyPIMPolicies completed. Processed: 0, Successful: 0, Failed: 0\n✅ [OK] Policy dry-run completed (-WhatIf) - role policies appear correctly configured for assignment compliance\n🧹 [CLEANUP] Analyzing existing assignments against configuration...\n[Cleanup] Starting cleanup (mode=delta)\n[Cleanup] Orchestrator analysis complete. Desired entries=9. No removals executed.\n📊 [CLEANUP] Analysis complete. Found 9 desired assignments.\n🔄 [CLEANUP] Delta mode: No assignments will be removed (add/update only).\n[ASSIGN] Creating assignments with validated role policies...\n[ASSIGN] Assignment processing complete: 0 total, 0 created, 0 failed, 0 skipped\nNo deferred group policies to process.\nDeferred Group Policies Retry:\n  Applied: 0\n  Skipped: 0\n  Failed : 0\n\n┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃ OVERALL SUMMARY                                                                ┃\n┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n┌───────────────────────────────────────────────────────────────────────────────┐\n| ASSIGNMENT CREATIONS\n├───────────────────────────────────────────────────────────────────────────────┤\n| [OK] Created : 0\n| [PLAN] Planned : 9\n| [SKIP] Skipped : 0\n| [FAIL] Failed  : 0\n└───────────────────────────────────────────────────────────────────────────────┘\n┌───────────────────────────────────────────────────────────────────────────────┐\n| POLICY OPERATIONS\n├───────────────────────────────────────────────────────────────────────────────┤\n| [OK] Applied : 0\n| [SKIP] Skipped : 12\n| [FAIL] Failed  : 0\n| [INFO] Total   : 0\n└───────────────────────────────────────────────────────────────────────────────┘\n┌───────────────────────────────────────────────────────────────────────────────┐\n| CLEANUP OPERATIONS\n├───────────────────────────────────────────────────────────────────────────────┤\n| [INFO] Analysis: 9 desired assignments analyzed\n| [INFO] Status  : Analyzed 9 desired assignments. Full cleanup requires core EasyPIM module.\n| [OK] Kept    : 0\n| [DEL] Removed : 0\n| [INFO] WouldRemove: 0\n| [SKIP] Skipped : 0\n└───────────────────────────────────────────────────────────────────────────────┘\n┌───────────────────────────────────────────────────────────────────────────────┐\n| DEFERRED GROUP POLICIES\n├───────────────────────────────────────────────────────────────────────────────┤\n| [OK] Applied           : 0\n| ⏳ Still Not Eligible: \n| [FAIL] Failed            : 0\n└───────────────────────────────────────────────────────────────────────────────┘\nMode semantics: delta = add/update only (no removals), initial = full reconcile (destructive).\n=== EasyPIM orchestration completed successfully ===\n🔍 [TELEMETRY] Checking telemetry configuration from config object...\n🔍 [DEBUG] Send-TelemetryEventFromConfig called for event: orchestrator_completion\n🔍 [DEBUG] Config object received, checking TelemetrySettings...\n🔍 [DEBUG] Config.TelemetrySettings exists: True\n🔍 [DEBUG] Config.TelemetrySettings.ALLOW_TELEMETRY value: True\n✅ [TELEMETRY] Telemetry enabled - preparing event: orchestrator_completion\n✅ [DEBUG] Telemetry enabled - proceeding with event: orchestrator_completion\nGenerated privacy-protected telemetry identifier (SHA256)\n✅ [DEBUG] Telemetry identifier created successfully\nRequested HTTP/1.1 POST with 777-byte payload\nReceived HTTP/1.1 15-byte response of content type application/json\nContent encoding: utf-8\nPostHog API responded successfully. Status: Ok\n✅ [DEBUG] PostHog API call succeeded\nTelemetry event sent successfully: orchestrator_completion\n✅ [DEBUG] Telemetry event sent successfully: orchestrator_completion\n",
  "AssignmentsAnalyzed": 9,
  "AssignmentsRemoved": 0,
  "FormattedSummary": "┌───────────────────────────────────────────────────────────────────────────────┐\n| ASSIGNMENT CREATIONS\n├───────────────────────────────────────────────────────────────────────────────┤\n| [OK] Created : 0\n| [PLAN] Planned : 9\n| [SKIP] Skipped : 0\n| [FAIL] Failed  : 0\n└───────────────────────────────────────────────────────────────────────────────┘\n┌───────────────────────────────────────────────────────────────────────────────┐\n| POLICY OPERATIONS\n├───────────────────────────────────────────────────────────────────────────────┤\n| [OK] Applied : 0\n| [SKIP] Skipped : 12\n| [FAIL] Failed  : 0\n| [INFO] Total   : 0\n└───────────────────────────────────────────────────────────────────────────────┘\n┌───────────────────────────────────────────────────────────────────────────────┐\n| CLEANUP OPERATIONS\n├───────────────────────────────────────────────────────────────────────────────┤\n| [INFO] Analysis: 9 desired assignments analyzed\n| [INFO] Status  : Analyzed 9 desired assignments. Full cleanup requires core EasyPIM module.\n| [OK] Kept    : 0\n| [DEL] Removed : 0\n| [INFO] WouldRemove: 0\n| [SKIP] Skipped : 0\n└───────────────────────────────────────────────────────────────────────────────┘\n┌───────────────────────────────────────────────────────────────────────────────┐\n| DEFERRED GROUP POLICIES\n├───────────────────────────────────────────────────────────────────────────────┤\n| [OK] Applied           : 0\n| ⏳ Still Not Eligible: \n| [FAIL] Failed            : 0\n└───────────────────────────────────────────────────────────────────────────────┘",
  "WhatIfMode": true,
  "Timestamp": "2025-09-07T11:54:56Z",
  "ExecutionMode": "delta"
}
